{% extends "base.html" %}
{% block title %}рдЧреЛрдбрд╛рдКрди / Godown{% endblock %}

{% block nav_tabs %}
<div class="tab-bar">
  <a href="/godown/dashboard" class="active">ЁЯПн рдЧреЛрдбрд╛рдКрди / Godown</a>
  <a href="/delivery/dashboard">ЁЯЪЪ Delivery</a>
  {% if request.session.user.role in ['OWNER','PARTNER'] %}<a href="/owner/dashboard">ЁЯСС Owner</a>{% endif %}
</div>
{% endblock %}

{% block content %}
<div class="page-title">ЁЯПн рдЧреЛрдбрд╛рдКрди рд╕реНрдЯреЙрдХ / Godown Stock</div>
<div class="page-sub">{{ today.strftime('%d %B %Y') }} ┬╖ {{ request.session.user.name }}</div>

<!-- STAT BOXES -->
<div class="stat-grid">
  <div class="stat-box green">
    <div class="val">{{ ledger_stock.get('5350',{}).get('filled',0) }}</div>
    <div class="lbl">14.2kg рднрд░рд▓реЗрд▓реЗ / Filled</div>
  </div>
  <div class="stat-box amber">
    <div class="val">{{ ledger_stock.get('5350',{}).get('empty',0) }}</div>
    <div class="lbl">14.2kg рд░рд┐рдХрд╛рдореЗ / Empty</div>
  </div>
  <div class="stat-box">
    <div class="val">{{ ledger_stock.get('5400',{}).get('filled',0) }}</div>
    <div class="lbl">19kg рднрд░рд▓реЗрд▓реЗ</div>
  </div>
  <div class="stat-box">
    <div class="val">{{ ledger_stock.get('5240',{}).get('filled',0) }}</div>
    <div class="lbl">5kg рднрд░рд▓реЗрд▓реЗ</div>
  </div>
</div>

{% if physical %}
<div class="alert alert-success">
  тЬЕ рдЖрдЬрдЪреА рдкреНрд░рддреНрдпрдХреНрд╖ рдореЛрдЬрдгреА / Today's Physical Count: 
  14.2kg рднрд░рд▓реЗрд▓реЗ = <strong>{{ physical.filled_14_2 }}</strong>, 
  рд░рд┐рдХрд╛рдореЗ = <strong>{{ physical.empty_14_2 }}</strong>
  {% if physical.filled_14_2 != ledger_stock.get('5350',{}).get('filled',0) %}
  <span style="color:#e02424;"> тЪая╕П Difference: {{ physical.filled_14_2 - ledger_stock.get('5350',{}).get('filled',0) }}</span>
  {% endif %}
</div>
{% else %}
<div class="alert alert-info">тЪая╕П рдЖрдЬрдЪреА рдореЛрдЬрдгреА рдЕрджреНрдпрд╛рдк рдирд╛рд╣реА / Physical count not entered yet today.</div>
{% endif %}

<!-- PHYSICAL STOCK ENTRY -->
<div class="card">
  <div class="card-title">ЁЯУЛ рдкреНрд░рддреНрдпрдХреНрд╖ рд╕реНрдЯреЙрдХ рдиреЛрдВрдж / Physical Stock Entry</div>
  <p style="font-size:0.8rem;color:#6b7280;margin-bottom:12px;">рдкреНрд░рддреНрдпреЗрдХ рд╡реЗрд│реА рдЧреЛрдбрд╛рдКрди рдЙрдШрдбрд▓реНрдпрд╛рд╡рд░ рднрд░рд╛ / Fill every time godown is opened</p>
  <form method="post" action="/godown/physical-stock">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
      <div class="form-group">
        <label>14.2kg рднрд░рд▓реЗрд▓реЗ / Filled<span class="mr">(godown рдордзреАрд▓)</span></label>
        <input type="number" name="filled_14_2" min="0" value="0" required>
      </div>
      <div class="form-group">
        <label>14.2kg рд░рд┐рдХрд╛рдореЗ / Empty<span class="mr">(godown рдордзреАрд▓)</span></label>
        <input type="number" name="empty_14_2" min="0" value="0" required>
      </div>
      <div class="form-group">
        <label>19kg рднрд░рд▓реЗрд▓реЗ</label>
        <input type="number" name="filled_19" min="0" value="0">
      </div>
      <div class="form-group">
        <label>19kg рд░рд┐рдХрд╛рдореЗ</label>
        <input type="number" name="empty_19" min="0" value="0">
      </div>
      <div class="form-group">
        <label>5kg рднрд░рд▓реЗрд▓реЗ</label>
        <input type="number" name="filled_5" min="0" value="0">
      </div>
      <div class="form-group">
        <label>5kg рд░рд┐рдХрд╛рдореЗ</label>
        <input type="number" name="empty_5" min="0" value="0">
      </div>
    </div>
    <div class="form-group">
      <label>Notes / рдЯреАрдк</label>
      <input type="text" name="notes" placeholder="Optional">
    </div>
    <button type="submit" class="btn btn-success btn-block">тЬЕ рд╕реНрдЯреЙрдХ рд╕реЗрд╡реНрд╣ рдХрд░рд╛ / Save Stock</button>
  </form>
</div>

<!-- BPCL MOVEMENT (Loader/Owner only) -->
{% if request.session.user.role in ['OWNER','PARTNER','OFFICE','LOADER'] %}
<div class="card">
  <div class="card-title">ЁЯЪЫ BPCL рд╕рд╛рдард╛ рд╣рд╛рд▓рдЪрд╛рд▓ / BPCL Cylinder Movement</div>
  <form method="post" action="/godown/bpcl-movement">
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;">
      <div class="form-group">
        <label>Product Code</label>
        <select name="product_code">
          <option value="5350">5350 тАУ 14.2kg</option>
          <option value="5400">5400 тАУ 19kg</option>
          <option value="5240">5240 тАУ 5kg Com</option>
          <option value="5250">5250 тАУ 5kg Dom</option>
        </select>
      </div>
      <div class="form-group">
        <label>BPCL рдХрдбреВрди рдорд┐рд│рд╛рд▓реЗ / Received</label>
        <input type="number" name="filled_received" min="0" value="0">
      </div>
      <div class="form-group">
        <label>BPCL рд▓рд╛ рдкрд░рдд / Returned Empty</label>
        <input type="number" name="empty_returned" min="0" value="0">
      </div>
    </div>
    <div class="form-group">
      <label>Notes</label>
      <input type="text" name="notes" placeholder="Optional">
    </div>
    <button type="submit" class="btn btn-primary">ЁЯТ╛ рдиреЛрдВрдж рдХрд░рд╛ / Record Movement</button>
  </form>

  {% if bpcl_movements %}
  <div style="margin-top:14px;">
    <p style="font-size:0.8rem;font-weight:600;margin-bottom:8px;">рдЖрдЬрдЪреНрдпрд╛ рдиреЛрдВрджреА / Today's Movements:</p>
    <div class="table-wrap">
      <table>
        <tr><th>Product</th><th>Received тЖУ</th><th>Returned тЖС</th></tr>
        {% for m in bpcl_movements %}
        <tr><td>{{ m.product_code }}</td><td style="color:#057a55;">+{{ m.filled_received }}</td><td style="color:#e02424;">-{{ m.empty_returned }}</td></tr>
        {% endfor %}
      </table>
    </div>
  </div>
  {% endif %}
</div>
{% endif %}

{% endblock %}
