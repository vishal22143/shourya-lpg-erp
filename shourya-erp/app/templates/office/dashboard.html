{% extends "base.html" %}
{% block title %}Office Dashboard{% endblock %}

{% block nav_tabs %}
<div class="tab-bar">
  <a href="/office/dashboard" class="active">ЁЯПв Office</a>
  <a href="/delivery/dashboard">ЁЯЪЪ Delivery</a>
  <a href="/delivery/upload-csv">ЁЯУВ CSV</a>
  <a href="/bda/dashboard">ЁЯПШя╕П BDA</a>
  {% if request.session.user.role in ['OWNER','PARTNER'] %}<a href="/owner/dashboard">ЁЯСС Owner</a>{% endif %}
</div>
{% endblock %}

{% block content %}
<div class="page-title">ЁЯПв Office Dashboard</div>
<div class="page-sub">{{ today.strftime('%d %B %Y') }}</div>

<!-- STATS -->
<div class="stat-grid">
  <div class="stat-box green">
    <div class="val">{{ total_deliveries }}</div>
    <div class="lbl">Delivered / рдЭрд╛рд▓реЗ</div>
  </div>
  <div class="stat-box green">
    <div class="val">тВ╣{{ total_cash_in|int }}</div>
    <div class="lbl">Cash In / рд░реЛрдЦ рдЖрд▓реЗ</div>
  </div>
  <div class="stat-box red">
    <div class="val">тВ╣{{ total_expenses|int }}</div>
    <div class="lbl">Expenses / рдЦрд░реНрдЪ</div>
  </div>
  <div class="stat-box">
    <div class="val">{{ trips|length }}</div>
    <div class="lbl">Trips / рдЯреНрд░рд┐рдкреНрд╕</div>
  </div>
</div>

<!-- OPENING CASH -->
<div class="card">
  <div class="card-title">ЁЯТ╡ Opening Cash / рд╕реБрд░реБрд╡рд╛рддреАрдЪреА рд░реЛрдЦ рд░рдХреНрдХрдо</div>
  <form method="post" action="/office/opening-cash">
    <div style="display:flex;gap:10px;align-items:flex-end;">
      <div class="form-group" style="flex:1;margin-bottom:0;">
        <label>Amount тВ╣ / рд░рдХреНрдХрдо</label>
        <input type="number" name="amount" placeholder="e.g. 5000" min="0" required inputmode="numeric">
      </div>
      <button type="submit" class="btn btn-success">ЁЯТ╛ Save</button>
    </div>
  </form>
</div>

<!-- ADD EXPENSE -->
<div class="card">
  <div class="card-title">ЁЯУд Expense / рдЦрд░реНрдЪ рдЬреЛрдбрд╛</div>
  <form method="post" action="/office/add-expense">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
      <div class="form-group">
        <label>Head / рдкреНрд░рдХрд╛рд░</label>
        <select name="head">
          <option value="DIESEL">тЫ╜ Diesel / рдбрд┐рдЭреЗрд▓</option>
          <option value="STATIONARY">ЁЯУЛ Stationary</option>
          <option value="VEHICLE_REPAIR">ЁЯФз Vehicle Repair</option>
          <option value="ELECTRICITY">ЁЯТб Electricity</option>
          <option value="MISC">Other / рдЗрддрд░</option>
        </select>
      </div>
      <div class="form-group">
        <label>Amount тВ╣</label>
        <input type="number" name="amount" min="0" required inputmode="numeric">
      </div>
      <div class="form-group">
        <label>Mode / рдкрджреНрдзрдд</label>
        <select name="mode">
          <option value="CASH">Cash</option>
          <option value="ONLINE">Online (GPay)</option>
        </select>
      </div>
      <div class="form-group">
        <label>Paid To / рдХреЛрдгрд╛рд▓рд╛</label>
        <input type="text" name="paid_to" placeholder="e.g. Mangave Pump">
      </div>
    </div>
    <button type="submit" class="btn btn-danger">тЮЦ Add Expense</button>
  </form>
</div>

<!-- STAFF ADVANCE -->
<div class="card">
  <div class="card-title">ЁЯТ│ Staff Advance / рдХрд░реНрдордЪрд╛рд░реА рдЕрдЧреНрд░рд┐рдо</div>
  <form method="post" action="/office/add-advance">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
      <div class="form-group">
        <label>Staff / рдХрд░реНрдордЪрд╛рд░реА</label>
        <select name="staff_id" required>
          {% for s in staff %}
          <option value="{{ s.id }}">{{ s.name }} ({{ s.role.value }})</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <label>Amount тВ╣</label>
        <input type="number" name="amount" min="0" required inputmode="numeric">
      </div>
    </div>
    <div class="form-group">
      <label>Notes</label>
      <input type="text" name="notes" placeholder="Reason for advance">
    </div>
    <button type="submit" class="btn btn-warning">ЁЯТ│ Give Advance</button>
  </form>
</div>

<!-- SV NEW CONNECTION -->
<div class="card">
  <div class="card-title">ЁЯЖХ New Connection (SV) / рдирд╡реАрди рдХрдиреЗрдХреНрд╢рди</div>
  <form method="post" action="/office/sv-connection">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
      <div class="form-group">
        <label>Customer Name / рдирд╛рд╡</label>
        <input type="text" name="consumer_name" required>
      </div>
      <div class="form-group">
        <label>Consumer No (if known)</label>
        <input type="text" name="consumer_no">
      </div>
      <div class="form-group">
        <label>Amount тВ╣ (default 4000)</label>
        <input type="number" name="amount" value="4000" min="0" inputmode="numeric">
      </div>
      <div class="form-group">
        <label>Mode</label>
        <select name="mode">
          <option value="CASH">Cash</option>
          <option value="ONLINE">Online</option>
        </select>
      </div>
    </div>
    <button type="submit" class="btn btn-primary">ЁЯЖХ Record SV Connection</button>
  </form>
</div>

<!-- TODAY'S EXPENSES TABLE -->
{% if expenses %}
<div class="card">
  <div class="card-title">ЁЯУЛ рдЖрдЬрдЪреЗ рдЦрд░реНрдЪ / Today's Expenses</div>
  <div class="table-wrap">
    <table>
      <tr><th>Head</th><th>Amount</th><th>Mode</th><th>Paid To</th></tr>
      {% for e in expenses %}
      <tr>
        <td>{{ e.head }}</td>
        <td style="color:#e02424;">тВ╣{{ e.amount|int }}</td>
        <td>{{ e.mode.value }}</td>
        <td>{{ e.paid_to or 'тАФ' }}</td>
      </tr>
      {% endfor %}
      <tr style="background:#fef3c7;font-weight:700;">
        <td>TOTAL</td>
        <td style="color:#e02424;">тВ╣{{ total_expenses|int }}</td>
        <td colspan="2"></td>
      </tr>
    </table>
  </div>
</div>
{% endif %}

<!-- STAFF ADVANCES TABLE -->
{% if advances %}
<div class="card">
  <div class="card-title">ЁЯТ│ рдЖрдЬрдЪреЗ рдЕрдЧреНрд░рд┐рдо / Today's Advances</div>
  <div class="table-wrap">
    <table>
      <tr><th>Staff</th><th>Amount</th><th>Source</th></tr>
      {% for a in advances %}
      <tr>
        <td>{{ a.staff.name }}</td>
        <td style="color:#c27803;">тВ╣{{ a.amount|int }}</td>
        <td><span class="badge badge-yellow">{{ a.source }}</span></td>
      </tr>
      {% endfor %}
    </table>
  </div>
</div>
{% endif %}

{% endblock %}
